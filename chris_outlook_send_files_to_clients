import win32com.client as win32
import os
from pandas import *

cwd = os.getcwd()
outlook = win32.Dispatch('outlook.application')

path = cwd+"\\"+"_email_setup.xlsx"
xls = ExcelFile(path)
df = xls.parse(xls.sheet_names[0],index_col=False)


for index, row in df.iterrows():
    
    #print(row["partner_name"])
    #print(row["partner_emails"])
    #print(cwd+"\\"+row["email_attachment_name"])
    #print(row["email_body"])
    
    if ";" in row["email_attachment_name"]:
        row["email_attachment_split"] = row["email_attachment_name"].split(';')
        for i in row["email_attachment_split"]:
            print ("this is one file:" +i)
    else:
        print(row["email_attachment_name"])
        
    mail = outlook.CreateItem(0)
    mail.To = row["partner_emails"]
    mail.Subject = row["email_subject"]
    mail.Body = row["email_body"]
    mail.Display(False)


    if ";" in row["email_attachment_name"]:
        row["email_attachment_split"] = row["email_attachment_name"].split(';')
        for i in row["email_attachment_split"]:
            attachment = cwd+"\\"+i.strip()
            mail.Attachments.Add(attachment)
                       
    else:
        attachment = cwd+"\\"+row["email_attachment_name"]
        mail.Attachments.Add(attachment)
